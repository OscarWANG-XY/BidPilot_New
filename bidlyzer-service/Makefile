.PHONY: test test-unit test-integration test-redis test-tiptap test-docx test-all test-all-integration start-test-worker stop-workers

# Celery Workerç®¡ç†
start-test-worker:
	@echo "ğŸš€ å¯åŠ¨Celeryæµ‹è¯•Worker..."
	@./start_test_worker.sh

stop-workers:
	@echo "ğŸ›‘ åœæ­¢æ‰€æœ‰Celery Worker..."
	@pkill -f "celery.*worker" 2>/dev/null || true
	@echo "âœ… å·²åœæ­¢æ‰€æœ‰Worker"

# è¿è¡Œç‰¹å®šé›†æˆæµ‹è¯•
test-redis:
	PYTHONPATH=. REDIS_TEST=true pytest app/core/tests/test_redis_integration.py -v

test-postgres:
	PYTHONPATH=. POSTGRES_TEST=true pytest \
		app/core/tests/test_postgres_integration.py \
		app/core/tests/test_postgres_unit.py -v

test-tiptap:
	PYTHONPATH=. TIPTAP_TEST=true pytest \
		app/clients/tiptap/tests/test_tiptap_client_integration.py \
		app/clients/tiptap/tests/test_tiptap_docx_integration.py \
		app/clients/tiptap/tests/test_tiptap_utils_integration.py \
		app/clients/tiptap/tests/test_tiptap_client_unit.py \
		app/clients/tiptap/tests/test_tiptap_docx_unit.py \
		app/clients/tiptap/tests/test_tiptap_utils_unit.py \
		app/clients/tiptap/tests/test_tiptap_helpers_unit.py -v

test-models:
	PYTHONPATH=. MODEL_TEST=true pytest \
		app/models/tests/test_models_structuring_integration.py \
		app/models/tests/test_models_structuring_interaction_integration.py \
		app/models/tests/test_models_structuring_unit.py -v


test-api:
	PYTHONPATH=. API_TEST=true pytest \
		app/api/tests/test_django_unit.py -v

test-celery:
	PYTHONPATH=. CELERY_TEST=true pytest \
		app/core/tests/test_celery.py -v

# ä½¿ç”¨æ ‡è®°è¿è¡Œæ‰€æœ‰é›†æˆæµ‹è¯•
test-integration:
	PYTHONPATH=. ALL_INTEGRATION_TESTS=true pytest -m integration -v

# æŒ‰æ ‡è®°è¿è¡Œç‰¹å®šé›†æˆæµ‹è¯•
test-integration-redis:
	PYTHONPATH=. ALL_INTEGRATION_TESTS=true pytest -m redis -v

test-integration-tiptap:
	PYTHONPATH=. ALL_INTEGRATION_TESTS=true pytest -m tiptap -v

# è¿è¡Œæ‰€æœ‰æµ‹è¯•
test-all:
	PYTHONPATH=. ALL_INTEGRATION_TESTS=true pytest

# åªè¿è¡Œæ‰€æœ‰é›†æˆæµ‹è¯•ï¼Œæ’é™¤å•å…ƒæµ‹è¯•
test-all-integration:
	PYTHONPATH=. ALL_INTEGRATION_TESTS=true pytest tests/integration

# é»˜è®¤æµ‹è¯•å‘½ä»¤
test: test-unit 